name: Terraform
scopeName: source.terraform
fileTypes: [tf,tfvars,tpl,tmpl]
uuid: dd7316da-3634-49ed-a8ea-d72e64bfb1a0

patterns:
- include: '#block-terraform'
- include: '#block-provider'
- include: '#block-locals'
- include: '#block-variable'
- include: '#block-output'
- include: '#block-module'
- include: '#block-resource'
- include: '#block-data'

repository:

# --- Top-level Blocks

  block-terraform:
    begin: ^\s*(terraform)\s*({)
    beginCaptures:
      1: { name: keyword.other.terraform }
      2: { name: meta.configuration.terraform punctuation.definition.bracket.curly.begin.terraform }
    end: ^\s*(})
    endCaptures:
      1: { name: punctuation.definition.bracket.curly.end.terraform }

  block-provider:
    begin: ^\s*(provider)\s*(")([a-z]+[-\w]*)(")\s*({)
    beginCaptures:
      1: { name: keyword.other.provider.terraform }
      2: { name: punctuation.definition.string.begin.terraform }
      3: { name: meta.provider.configuration.terraform  string.quoted.double.terraform entity.name.provider.terraform }
      4: { name: punctuation.definition.string.end.terraform }
      5: { name: punctuation.definition.bracket.curly.begin.terraform }
    end: ^\s*(})
    endCaptures:
      1: { name: punctuation.definition.bracket.curly.end.terraform }
    patterns:
    - include: '$self'

  block-locals:
    begin: ^\s*(locals)\s*({)
    beginCaptures:
      1: { name: keyword.other.locals.terraform }
      2: { name: punctuation.definition.bracket.curly.begin.terraform }
    end: ^\s*(})
    endCaptures:
      1: { name: punctuation.definition.bracket.curly.end.terraform }

  block-variable:
    begin: ^\s*(variable)\s*(")([a-z]+[-\w]*)(")\s*({)
    beginCaptures:
      1: { name: keyword.other.variable.terraform }
      2: { name: punctuation.definition.string.begin.terraform }
      3: { name: meta.variable.name.terraform string.quoted.double.terraform entity.name.variable.terraform }
      4: { name: punctuation.definition.string.end.terraform }
      5: { name: punctuation.definition.bracket.curly.begin.terraform }
    end: ^\s*(})
    endCaptures:
      1: { name: punctuation.definition.bracket.curly.end.terraform }

  block-output:
    begin: ^\s*(output)\s*(")([a-z]+[-\w]*)(")\s*({)
    beginCaptures:
      1: { name: keyword.other.output.terraform }
      2: { name: punctuation.definition.string.begin.terraform }
      3: { name: meta.output.name.terraform string.quoted.double.terraform entity.name.output.terraform }
      4: { name: punctuation.definition.string.end.terraform }
      5: { name: punctuation.definition.bracket.curly.begin.terraform }
    end: ^\s*(})
    endCaptures:
      1: { name: punctuation.definition.bracket.curly.end.terraform }

  block-module:
    begin: ^\s*(module)\s*(")([a-z]+[-\w]*)(")\s*({)
    beginCaptures:
      1: { name: keyword.other.module.terraform }
      2: { name: punctuation.definition.string.begin.terraform }
      3: { name: string.quoted.double.terraform entity.name.module.terraform }
      4: { name: punctuation.definition.string.end.terraform }
      5: { name: punctuation.definition.bracket.curly.begin.terraform }
    end: ^\s*(})
    endCaptures:
      1: { name: punctuation.definition.bracket.curly.end.terraform }

  block-resource:
    begin: ^\s*(resource)\s*(")([a-z]+[-\w]*)(")\s+(")([a-z]+[-\w]*)(")\s*({)
    beginCaptures:
      1: { name: keyword.other.resource.terraform }
      2: { name: punctuation.definition.string.begin.terraform }
      3: { name: meta.resource.provider string.quoted.double.terraform support.function.data.terraform }
      4: { name: punctuation.definition.string.end.terraform }
      5: { name: punctuation.definition.string.begin.terraform }
      6: { name: meta.resource.name string.quoted.double.terraform entity.name.resource.terraform }
      7: { name: punctuation.definition.string.end.terraform }
      8: { name: punctuation.definition.bracket.curly.begin.terraform }
    end: ^\s*(})
    endCaptures:
      1: { name: punctuation.definition.bracket.curly.end.terraform }

  block-data:
    begin: ^\s*(data)\s*(")([a-z]+[-\w]*)(")\s+(")([a-z]+[-\w]*)(")\s*({)
    beginCaptures:
      1: { name: keyword.other.data.terraform }
      2: { name: punctuation.definition.string.begin.terraform }
      3: { name: meta.data.provider string.quoted.double.terraform support.function.data.terraform }
      4: { name: punctuation.definition.string.end.terraform }
      5: { name: punctuation.definition.string.begin.terraform }
      6: { name: meta.data.name string.quoted.double.terraform entity.name.data.terraform }
      7: { name: punctuation.definition.string.end.terraform }
      8: { name: punctuation.definition.bracket.curly.begin.terraform }
    end: ^\s*(})
    endCaptures:
      1: { name: punctuation.definition.bracket.curly.end.terraform }
